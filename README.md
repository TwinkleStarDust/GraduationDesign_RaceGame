# GraduationDesign_RaceGame

毕业设计 - 赛车游戏

## 项目概述

这是一个基于 Unity 引擎开发的赛车游戏项目，旨在实现车辆的物理模拟、场景碰撞检测和基本的游戏玩法。

## 功能特性

- 基于物理的车辆控制系统
- 真实的车轮碰撞和悬挂系统
- 平滑的相机跟随系统
- 支持第一人称、第三人称和环绕视角切换
- 简单的 UI 系统显示车辆信息
- 传送点系统，方便快速测试不同位置

## 控制说明

- **W/↑** - 加速
- **S/↓** - 刹车/倒车
- **A/←** - 左转
- **D/→** - 右转
- **空格** - 手刹
- **左 Shift** - 氮气加速
- **R** - 重置车辆位置
- **V** - 切换视角（第三人称/第一人称/环绕视角）
- **鼠标移动** - 在环绕视角模式下旋转相机
- **A/D** - 当车辆侧翻时，用于翻转车辆
- **W/S/A/D** - 当车辆在空中时，用于控制车辆姿态
- **T** - 打开/关闭传送点面板

## 项目结构

- **Assets/Scripts/Vehicle/** - 车辆相关脚本
  - **VehicleController.cs** - 车辆控制器，处理车辆的物理和运动
  - **VehicleInputHandler.cs** - 输入处理器，处理玩家输入
  - **VehicleCamera.cs** - 相机控制器，处理相机跟随
  - **VehicleUI.cs** - UI 控制器，显示车辆信息
- **Assets/Scripts/Teleport/** - 传送系统相关脚本
  - **TeleportPoint.cs** - 传送点脚本，定义传送点位置和属性
  - **TeleportManager.cs** - 传送管理器，处理传送逻辑
  - **TeleportButton.cs** - 传送按钮 UI，处理传送按钮交互
  - **FadePanel.cs** - 淡入淡出效果面板，用于传送过渡效果

## 如何使用

1. 在场景中创建一个车辆模型（可以使用项目中提供的模型）
2. 为车辆添加以下组件：
   - Rigidbody（刚体）
   - VehicleController 脚本
   - VehicleInputHandler 脚本
3. 为车辆的每个车轮添加 WheelCollider 组件
4. 在 VehicleController 脚本中设置车轮碰撞器和车轮模型
5. 创建一个相机并添加 VehicleCamera 脚本，设置目标为车辆
6. 创建 UI 元素并添加 VehicleUI 脚本

## 开发计划

- [x] 基本车辆控制系统
- [x] 相机跟随系统
- [x] 基本 UI 系统
- [x] 传送点系统
- [x] Ackerman 转向系统
- [x] 下压力系统
- [x] 引擎扭矩曲线
- [x] 氮气加速系统
- [x] 车辆粒子效果系统
- [x] 小地图系统
- [ ] 赛道系统和计时器
- [ ] AI 对手
- [ ] 多人游戏支持
- [ ] 车辆自定义系统
- [ ] 游戏模式（竞速、漂移等）

## 技术细节

- 使用 Unity 的 WheelCollider 组件模拟车轮物理
- 使用 Rigidbody 组件处理车辆物理
- 使用 Unity 的新输入系统处理输入
- 使用 TextMeshPro 显示 UI 文本

## 注意事项

- 车辆控制器需要正确设置车轮碰撞器和车轮模型才能正常工作
- 车辆的重心高度对稳定性有很大影响，可以通过调整 centerOfMassHeight 参数来优化
- 车辆参数（最大速度、加速度等）可以根据需要进行调整

## 车辆参数配置指南

本指南详细说明了车辆控制系统中各项参数的作用、影响和建议值。通过调整这些参数，你可以创建不同类型的车辆，从家用轿车到竞速跑车。

### 基本参数设置

#### 驱动类型 (DriveType)

- **前轮驱动 (FWD)**

  - 特点：加速稳定，转向灵敏，高速可能欠转
  - 适用：家用轿车、紧凑型车
  - 优点：良好的牵引力，适合日常驾驶
  - 缺点：高速转弯性能较差

- **后轮驱动 (RWD)**

  - 特点：加速时后轮易打滑，漂移性能好
  - 适用：跑车、运动型车辆
  - 优点：更好的转向性能，适合漂移
  - 缺点：需要更多驾驶技巧

- **四轮驱动 (AWD)**
  - 特点：综合性能最佳，加速和抓地力都很好
  - 适用：SUV、高性能车辆
  - 优点：最佳的牵引力和稳定性
  - 缺点：车重较大，油耗较高

### 速度与加速度参数

#### 最大速度 (maxSpeed)

- 单位：km/h
- 建议范围：
  - 家用轿车：130-180 km/h
  - 运动型轿车：180-220 km/h
  - 超级跑车：220-350 km/h
  - 赛车：250-400 km/h

#### 最大后退速度 (maxReverseSpeed)

- 单位：km/h
- 建议范围：20-40 km/h
- 注意：后退速度过高可能导致车辆不稳定

#### 加速度 (acceleration)

- 建议范围：
  - 家用轿车：5-8
  - 运动型轿车：8-12
  - 超级跑车：12-15
  - 赛车：15-20

#### 制动力 (brakeForce)

- 建议范围：
  - 家用轿车：10-15
  - 运动型轿车：15-20
  - 超级跑车：20-25
  - 赛车：25-30

### 转向参数

#### 转向速度 (steeringSpeed)

- 建议范围：40-100
- 较低的值使转向更平滑
- 较高的值使转向更快速

#### 最大转向角度 (maxSteeringAngle)

- 建议范围：30-45 度
- 较小角度适合高速行驶
- 较大角度适合低速操作

### 漂移参数

#### 漂移强度 (driftFactor)

- 范围：0-1
- 建议值：
  - 家用轿车：0.3-0.4
  - 运动型轿车：0.5-0.6
  - 漂移车：0.7-0.9

#### 漂移时后轮侧向摩擦力减少系数 (driftSlipFactor)

- 范围：0-1
- 建议值：
  - 家用轿车：0.5-0.6
  - 运动型轿车：0.4-0.5
  - 漂移车：0.2-0.3

#### 漂移恢复速度 (driftRecoverySpeed)

- 建议范围：1-5
- 较低的值使漂移持续时间更长
- 较高的值使车辆更快恢复正常行驶

#### 漂移时转向灵敏度增加 (driftSteeringFactor)

- 范围：1-2
- 建议值：
  - 家用轿车：1.1-1.2
  - 运动型轿车：1.2-1.4
  - 漂移车：1.4-1.8

### 车辆物理参数

#### 重心高度 (centerOfMassHeight)

- 建议范围：-0.8 到 -0.3
- 较低的值（更负）使车辆更稳定
- 较高的值使车辆更容易翻转
- 建议值：
  - 跑车：-0.7 到 -0.6
  - 轿车：-0.6 到 -0.5
  - SUV：-0.5 到 -0.3

### 车轮视觉效果参数

#### 车轮位置平滑度 (wheelPositionSmoothing)

- 范围：5-30
- 控制车轮上下移动的平滑程度
- 较低的值使车轮反应更快但可能抖动
- 较高的值使车轮移动更平滑但反应较慢
- 建议值：12-18

#### 车轮旋转平滑度 (wheelRotationSmoothing)

- 范围：5-30
- 控制车轮旋转的平滑程度
- 较低的值使车轮转向更快但可能不自然
- 较高的值使车轮转向更平滑但反应较慢
- 建议值：12-18

### 车辆翻转与空中控制参数

#### 车辆翻转设置

- **车辆翻转力矩 (flipTorque)**

  - 范围：10000-30000
  - 控制车辆侧翻时翻转的力度
  - 较低的值使翻转更平缓但可能力度不足
  - 较高的值使翻转更迅速但可能过于敏感
  - 建议值：20000

- **检测侧翻的角度阈值 (flipDetectionAngle)**

  - 范围：30-60 度
  - 当车辆与地面的角度超过此值时，判定为侧翻
  - 较低的值使侧翻检测更敏感
  - 较高的值使侧翻检测更宽容
  - 建议值：45 度

- **检测倒置的角度阈值 (upsideDownDetectionAngle)**

  - 范围：100-150 度
  - 当车辆与地面的角度超过此值时，判定为倒置
  - 建议值：120 度

- **翻转恢复速度 (flipRecoverySpeed)**
  - 范围：1-5
  - 控制翻转力矩的平滑过渡速度
  - 较低的值使翻转更平滑
  - 较高的值使翻转响应更快
  - 建议值：2-3

#### 空中控制设置

- **空中翻滚力矩 (airRollTorque)**

  - 范围：30000-120000
  - 控制车辆在空中左右翻滚的力度
  - 建议值：100000

- **空中俯仰力矩 (airPitchTorque)**

  - 范围：20000-100000
  - 控制车辆在空中前后翻转的力度
  - 建议值：80000

- **检测空中状态的时间阈值 (airTimeThreshold)**
  - 范围：0.2-1.0 秒
  - 车辆离地超过此时间后，启用空中控制
  - 较低的值使空中控制更快启用
  - 较高的值避免短暂跳跃时不必要的空中控制
  - 建议值：0.3 秒

### 使用技巧

#### 车辆侧翻恢复

当车辆侧翻或倒置时，UI 会显示提示信息。此时：

1. 使用**A 键**向左翻转车辆
2. 使用**D 键**向右翻转车辆
3. 翻转力度会根据按键力度自动调整
4. 车辆速度过高时无法使用翻转功能，需等待车辆减速

#### 空中姿态控制

当车辆跳跃或从坡道飞出进入空中状态时，UI 会显示空中控制提示。此时：

1. 使用**W 键**使车辆前翻
2. 使用**S 键**使车辆后翻
3. 使用**A 键**使车辆左翻滚
4. 使用**D 键**使车辆右翻滚
5. 可以组合按键实现复杂的空中动作

这些控制可以帮助车辆在着陆时保持正确姿态，避免侧翻或倒置。熟练掌握空中控制可以实现各种特技动作，如空中 360 度旋转等。

### 调试建议

1. **翻转力度不足**

   - 增加 flipTorque 值
   - 确保车辆重量不要过大

2. **翻转过于敏感**

   - 减小 flipTorque 值
   - 增加 flipRecoverySpeed 值使翻转更平滑

3. **空中控制不灵敏**

   - 增加 airRollTorque 和 airPitchTorque 值
   - 减小 airTimeThreshold 使控制更快启用

4. **空中控制过于敏感**
   - 减小 airRollTorque 和 airPitchTorque 值
   - 增加车辆的惯性张量使旋转更稳定

### 音效参数

#### 引擎音效

- minPitch：0.5-0.8（怠速音调）
- maxPitch：1.5-2.0（最高转速音调）
- 音量随速度和油门变化

#### 漂移音效

- 音量随漂移强度变化
- 建议添加适当的淡入淡出效果

注意：所有参数都可以根据具体需求进行微调，上述建议值仅供参考。在调整参数时，建议小幅度改动并及时测试效果。

## 相机系统参数配置

### 视角模式

游戏支持三种不同的相机视角模式：

#### 第三人称视角

- 相机跟随车辆后方
- 根据车速自动调整相机位置和旋转
- 适合观察车辆整体运动和周围环境

#### 第一人称视角

- 相机位于车内驾驶位置
- 提供真实的驾驶体验
- 适合沉浸式驾驶

#### 环绕视角

- 使用鼠标自由控制相机角度
- 以车辆为固定中心点进行环绕
- 在此模式下鼠标光标会被隐藏
- 适合观察车辆的各个角度和细节

### 相机参数设置

#### 第三人称参数

- **distance**：相机与车辆的距离（建议值：5-8）
- **height**：相机高度（建议值：1.5-3）
- **smoothness**：相机平滑度（建议值：5-15）
- **rotationSpeed**：相机旋转速度（建议值：3-8）

#### 第一人称参数

- **firstPersonOffset**：第一人称视角偏移（建议值：(0, 1.5, 0.2)）
  - X 值：左右偏移（0 为中心）
  - Y 值：上下高度（与驾驶员视线高度相关）
  - Z 值：前后偏移（正值更靠近前挡风玻璃）

#### 环绕视角参数

- **mouseSensitivityX**：鼠标水平灵敏度（建议值：2-5）
- **mouseSensitivityY**：鼠标垂直灵敏度（建议值：1.5-4）
- **minVerticalAngle**：垂直视角最小值（建议值：-30 到-20）
- **maxVerticalAngle**：垂直视角最大值（建议值：50-70）
- **orbitDistance**：环绕视角相机距离（建议值：4-7）
- **orbitHeightOffset**：环绕视角高度偏移（建议值：1-2）
- **hideCursorInMouseMode**：是否在环绕视角模式下隐藏鼠标（默认：是）

### 视角切换

按下 V 键可以循环切换三种视角模式。在游戏 UI 中会显示当前的视角模式。

### 调试建议

1. **相机抖动问题**

   - 增加 smoothness 值使相机运动更平滑
   - 减小 rotationSpeed 值减少相机旋转速度

2. **第一人称视角调整**

   - 调整 firstPersonOffset 的 Y 值以匹配车辆驾驶位高度
   - 调整 firstPersonOffset 的 Z 值以获得合适的前方视野

3. **环绕视角灵敏度**
   - 如果相机旋转太快：减小 mouseSensitivityX 和 mouseSensitivityY
   - 如果相机旋转太慢：增加 mouseSensitivityX 和 mouseSensitivityY

## 传送系统使用指南

传送系统允许玩家快速将车辆传送到场景中的不同位置，方便测试和探索。

### 创建传送点

1. 在场景中创建一个空游戏对象
2. 添加 `TeleportPoint` 脚本
3. 设置传送点的名称、描述和外观
4. 调整传送点的位置和旋转（车辆将按此方向传送）

### 传送点参数

- **传送点名称 (PointName)** - 显示在 UI 按钮上的名称
- **传送点描述 (Description)** - 鼠标悬停时显示的描述文本
- **传送点图标 (Icon)** - 按钮上显示的图标
- **传送点颜色 (PointColor)** - 图标和可视化效果的颜色
- **显示可视化效果 (ShowVisualizer)** - 在编辑器中是否显示可视化效果
- **可视化效果大小 (VisualizerSize)** - 编辑器中可视化效果的大小

### 设置传送管理器

1. 创建一个空游戏对象并添加 `TeleportManager` 脚本
2. 创建传送 UI 面板，包含：
   - 传送按钮容器（用于存放传送点按钮）
   - 切换按钮（用于打开/关闭传送面板）
3. 创建传送按钮预制体，添加 `TeleportButton` 脚本
4. 创建淡入淡出效果面板，添加 `FadePanel` 脚本
5. 在 `TeleportManager` 中设置相关引用

### 传送管理器参数

- **传送点按钮预制体 (teleportButtonPrefab)** - 用于创建传送按钮的预制体
- **传送点按钮容器 (buttonContainer)** - 存放传送按钮的容器
- **传送点 UI 面板 (teleportPanel)** - 传送 UI 主面板
- **传送点 UI 切换按钮 (toggleButton)** - 用于打开/关闭传送面板的按钮
- **传送点 UI 切换按钮文本 (toggleButtonText)** - 切换按钮上的文本
- **使用淡入淡出效果 (useFadeEffect)** - 传送时是否使用淡入淡出效果
- **淡入淡出效果面板 (fadePanel)** - 淡入淡出效果的 Canvas Group
- **淡入淡出持续时间 (fadeDuration)** - 淡入淡出效果的持续时间

### 使用传送系统

1. 在游戏中按下 **T** 键打开传送面板
2. 点击任意传送点按钮将车辆传送到该位置
3. 传送完成后面板会自动关闭

### 传送效果

- 传送时车辆会被重置（速度、加速度、转向等）
- 可以启用淡入淡出效果使传送更加平滑
- 传送后车辆会稍微抬高，防止陷入地面

### 调试建议

1. **传送后车辆不稳定**

   - 确保传送点位置不会与其他物体碰撞
   - 调整传送点的高度，确保车辆有足够的空间

2. **传送点不可见**

   - 在编辑器中启用 `ShowVisualizer` 选项
   - 增加 `VisualizerSize` 使可视化效果更明显

3. **传送按钮不显示**
   - 检查传送按钮预制体是否正确设置
   - 确保 `TeleportManager` 中的引用正确设置

## 更新日志

### 2025-03-14 - 空中控制系统优化

- **空中控制系统增强**

  - 优化了空中桶滚和俯仰控制的实现机制
  - 改进了力矩应用方式，使空中特技动作更加流畅
  - 添加了空中姿态稳定系统，帮助车辆保持平衡
  - 实现了空中旋转阻尼机制，使旋转更加可控
  - 增强了空中高度维持功能，延长空中操作时间

- **空中控制使用技巧**
  - 短按 A/D 键可以进行小幅度的翻滚
  - 长按 A/D 键可以进行完整的桶滚
  - 同时按 W/S 键可以调整车辆的俯仰角度，帮助控制着陆姿态
  - 松开按键后，车辆会逐渐停止旋转，不会立即停止
  - 系统会自动限制最大角速度，防止旋转过快导致失控

### 2025-03-15 - 传送系统实现

- **传送点系统**

  - 新增`TeleportPoint.cs`脚本，用于定义场景中的传送位置
  - 实现了传送点编辑器可视化功能，方便开发者定位和调整
  - 支持自定义传送点名称、描述、图标和颜色

- **传送管理器**

  - 新增`TeleportManager.cs`脚本，管理所有传送点和传送逻辑
  - 实现了动态传送点查找和按钮生成功能
  - 添加了传送前后的事件系统，支持其他系统响应传送操作

- **传送 UI 系统**

  - 新增`TeleportButton.cs`脚本，处理传送按钮的交互逻辑
  - 实现了按钮悬停提示和点击效果
  - 支持中文名称和描述显示

- **视觉效果**

  - 新增`FadePanel.cs`脚本，实现传送过程中的淡入淡出效果
  - 添加了传送过程中的相机过渡效果
  - 实现了传送点在编辑器中的可视化效果

- **输入控制**
  - 新增`TeleportInputHandler.cs`脚本，处理传送系统的输入控制
  - 实现了 T 键开关传送面板功能
  - 添加了传送点列表刷新机制

### 2024 年 3 月 15 日更新

- 添加了 Ackerman 转向系统，使车辆转向更加真实
- 实现了下压力系统，提高高速行驶时的车辆稳定性
- 添加了引擎扭矩曲线，使车辆加速更加真实
- 实现了氮气加速系统，按下左 Shift 键可以激活氮气加速
- 更新了 UI 系统，显示氮气状态

## 车辆参数配置指南

### 新增高级物理参数

#### Ackerman 转向系统

- **是否启用 Ackerman 转向 (useAckermanSteering)**

  - 启用后，车辆在转弯时内外轮转向角度不同，更符合真实车辆转向特性
  - 建议：对于追求真实驾驶体验的车辆启用

- **Ackerman 转向系数 (ackermanCoefficient)**
  - 范围：0-1
  - 控制内外轮转向角度差异的程度
  - 较低的值使转向更接近传统转向
  - 较高的值使内外轮转向角度差异更明显
  - 建议值：0.15-0.3

#### 下压力系统

- **下压力系数 (downforceCoefficient)**
  - 控制高速行驶时车辆的下压力大小
  - 较低的值使车辆在高速时更容易飘起
  - 较高的值使车辆在高速时更稳定，但可能影响跳跃和特技表现
  - 建议值：
    - 普通车辆：0.5-1.0
    - 赛车：1.0-2.0

#### 引擎扭矩曲线

- **引擎扭矩曲线 (engineTorqueCurve)**
  - 使用动画曲线定义不同速度下的引擎输出扭矩
  - 可以模拟真实车辆的动力输出特性
  - 默认曲线：
    - 起步阶段 (0-20% 最大速度)：扭矩从 0.8 上升到 1.0
    - 中速阶段 (20-60% 最大速度)：扭矩保持在 1.0 到 0.8
    - 高速阶段 (60-100% 最大速度)：扭矩从 0.8 下降到 0.6

#### 氮气系统

- **氮气容量 (nitroCapacity)**

  - 氮气的最大容量
  - 建议值：100

- **氮气恢复速度 (nitroRecoveryRate)**

  - 氮气每秒恢复的量
  - 建议值：10-20

- **氮气消耗速度 (nitroConsumptionRate)**

  - 使用氮气时每秒消耗的量
  - 建议值：20-30

- **氮气加速提升系数 (nitroBoostFactor)**
  - 使用氮气时加速度的倍增系数
  - 建议值：1.3-1.8

## 车辆粒子效果系统

车辆粒子效果系统为游戏增加了视觉上的真实感和反馈，使驾驶体验更加沉浸。

### 功能特点

- **轮胎烟雾/灰尘**: 当车辆漂移、急加速或在特定路面行驶时产生
- **氮气尾焰**: 激活氮气系统时从排气管喷出的蓝色火焰
- **刹车痕迹**: 高速紧急刹车时在车轮处显示
- **排气系统**: 根据引擎负载变化的排气效果
- **碰撞火花**: 车辆碰撞时产生的火花效果

### 如何使用

1. 确保车辆已添加 `VehicleEffectsManager` 组件
2. 创建所需的粒子效果预制体 (详见 `Assets/学习笔记文档/车辆粒子效果设置指南.md`)
3. 在 `VehicleEffectsManager` 组件中设置相应的粒子效果预制体
4. 根据需要调整参数，如最小速度阈值、烟雾强度等

### 高级设置

- 可以根据不同路面类型调整粒子效果的颜色和强度
- 支持与天气系统集成，在雨天或雪天显示不同效果
- 可通过性能设置调整粒子数量和复杂度

### 注意事项

- 过多的粒子效果可能影响游戏性能，请根据目标平台适当调整
- 建议在低端设备上提供关闭或降低粒子效果的选项

## 小地图系统

小地图系统提供了直观的场景导航功能，显示玩家位置、其他车辆位置和重要地标。

### 功能特点

- **实时位置显示**: 玩家车辆在小地图上的实时位置和方向
- **旋转模式**: 支持固定模式（北方向上）和跟随模式（玩家方向向上）
- **缩放功能**: 可调整小地图的缩放级别，查看更多或更少的区域
- **标记系统**: 显示检查点、起点、终点和其他车辆等
- **全屏模式**: 支持切换到更大的小地图视图，查看更多详情

### 如何使用

1. 在游戏 UI 中右上角可以看到小地图
2. 使用键盘快捷键控制小地图功能：
   - **M 键**: 切换小地图全屏显示
   - **R 键**: 切换小地图旋转模式
   - **+/-键**: 调整小地图缩放级别

### 扩展应用

- 可用于显示赛道布局和当前位置
- 在多人游戏中显示其他玩家位置
- 显示重要的游戏物品或障碍物

### 技术实现

- 使用正交相机从顶部俯视场景
- 将相机渲染的内容显示在 UI 中的 RawImage 上
- 使用坐标转换将世界坐标映射到小地图坐标

### 注意事项

- 小地图会增加一定的性能开销，特别是在地图复杂的场景中
- 使用适当的缩放级别以保持可读性和性能平衡
